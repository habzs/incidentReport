<!DOCTYPE html>
<html>

<!-- MUI -->
<link href="//cdn.muicss.com/mui-0.10.1/css/mui.min.css" rel="stylesheet" type="text/css" />
<script src="//cdn.muicss.com/mui-0.10.1/js/mui.min.js"></script>
<!-- JQUERY -->
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />


<head>
    <title>Incident report generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
</head>

<body>

    <div class="mui-appbar">
        <table width="100%">
          <tr style="vertical-align:middle;">
            <td class="mui--appbar-height mui-container-fluid mui--text-headline">7th Coy Incident Report Generator</td>
            <!-- <td class="mui--appbar-height" align="right">Right Side</td> -->
          </tr>
        </table>
    </div>

    <div class="mui-container-fluid" style="margin-top:10px;">
        <form id="form1" class="mui-form">
            <div class="mui-textfield mui-textfield--float-label">
                <input pattern="[0-9]" inputmode="numeric" type="number" id="fourDigits" name="fourDigits" onfocusout="fillName()">
                <label for="fourDigits">4D:</label>
            </div>

            <div class="mui-textfield mui-textfield--float-label">
                <input type="text" id="name" name="name">
                <label for="name">Name:</label>
            </div>

            <div class="mui-textfield mui-textfield--float-label">
                <input type="text" id="reason" name="reason">
                <label for="reason">Reason:</label>
            </div>

            <div class="mui-row" id="statusBiggerDiv">
                <div class="mui-textfield mui-textfield--float-label mui-col-xs-6">
                    <input type="text" id="status1" name="status1" class="autoc">
                    <label for="status1">Status:</label>
                </div>

                <div pattern="[0-9]" class="mui-textfield mui-textfield--float-label mui-col-xs-6">
                    <input pattern="[0-9]" inputmode="numeric" type="number" id="day1" name="day1">
                    <label for="day1">Days:</label>
                </div>
            </div>

        </form>
    </div>

    <div class="mui-container-fluid">
        <button onclick="addStatus()" class="mui-btn mui-btn--primary">+</button>
        <button onclick="generateOutput()" class="add mui-btn mui-btn--primary">Generate</button><br><br>

        <div class="mui-textfield">
            <!-- <textarea id="outputTextArea" rows="4" cols="50">T</textarea> -->
            <textarea id="outputTextArea" placeholder="Generated text here"></textarea>
        </div>

        <button onclick="copyToClipboard()" class="mui-btn mui-btn--primary">Copy</button>

    </div>
</body>

<script>

    var output = "";
    var statusCounter = 1;
    var statusOutput = [];
    var statusBox = 0;
    var lister = "";

    function addStatus(){
        statusCounter++;

        // --- STATUS GENERATION ---
        var statusDiv = document.createElement("div");
        statusDiv.setAttribute("class", "mui-textfield mui-textfield--float-label mui-col-xs-6");
        statusDiv.setAttribute("id", "statusDiv" + statusCounter);
        document.getElementById("statusBiggerDiv").appendChild(statusDiv);

        var statusInput = document.createElement("INPUT");
        statusInput.setAttribute("type", "text");
        statusInput.setAttribute("class", "autoc");
        statusInput.setAttribute("autocomplete", "off");
        statusInput.setAttribute("id", "status" + statusCounter);
        document.getElementById("statusDiv" + statusCounter).appendChild(statusInput);

        var statusLabel = document.createElement("LABEL");
        statusLabel.textContent = "Status: ";
        document.getElementById("statusDiv" + statusCounter).appendChild(statusLabel);

        // ---

        // --- DAY GENERATION ---

        var dayDiv = document.createElement("div");
        dayDiv.setAttribute("class", "mui-textfield mui-textfield--float-label mui-col-xs-6");
        dayDiv.setAttribute("id", "dayDiv" + statusCounter);
        document.getElementById("statusBiggerDiv").appendChild(dayDiv);

        var dayInput = document.createElement("INPUT");
        dayInput.setAttribute("type", "number");
        dayInput.setAttribute("pattern", "[0-9]");
        dayInput.setAttribute("inputmode", "numeric");
        dayInput.setAttribute("id", "day" + statusCounter);
        document.getElementById("dayDiv" + statusCounter).appendChild(dayInput);

        var dayLabel = document.createElement("LABEL");
        dayLabel.textContent = "Days: ";
        document.getElementById("dayDiv" + statusCounter).appendChild(dayLabel);

        // ---
    }

    var today = new Date();
    var day, month, year;
    var currentDate;
    var formInput = document.getElementById("form1");

    var dd = today.getDate();
    var mm = today.getMonth()+1;
    var yy = 20;

    function generateOutput(){

        statusOutput = [];
        
        // formInput = document.getElementById("form1");

        fourDigits = formInput.elements[0].value;
        name = formInput.elements[1].value;
        reason = formInput.elements[2].value;
        
        // statusBox is box ID, statusCounter is the number of boxes there are.
        // loops through number of boxes, and adds it into the array.
        for (let i=0; i<statusCounter; i++) {
            statusBox = i + 1;

            // Adds number of days
            statusOutput[i] = formInput.elements.namedItem("day" + statusBox).value + " days";
            // Adds status
            statusOutput[i] += " " + formInput.elements.namedItem("status" + statusBox).value;


            
            // Adds date
            futureDD = parseInt(dd) + parseInt(formInput.elements.namedItem("day" + statusBox).value);

            // Adds "0" if day/month is only 1 digit.
            if (dd < 10) {
                dd = "0" + dd;
            }

            if (mm < 10) {
                mm = "0" + mm;
            }
            
            endDate = futureDD.toString() + mm + yy;
            currentDate = dd + mm + yy;

            statusOutput[i] += " (" + currentDate+ "-" + endDate + ")";
            

            console.log(statusOutput);

            console.log("type of dd: " + typeof(dd));

            console.log("futureDate: " + futureDD);
            console.log("currentDate: " + currentDate);


            // Resets manipulated dd and mm
            dd = today.getDate();
            mm = today.getMonth() + 1;

        }

        console.log("statusBox: " + statusBox);
        console.log("statusCounter: " + statusCounter);

        statusOutput.forEach(outputFunc);
        output = fourDigits + " REC " + name + " has finished reporting sick at RHMC for " + reason + " and received " + lister;
        lister = "";

        document.getElementById("outputTextArea").innerHTML = output;

    }

    function outputFunc(item, index) {
    lister += item + ", ";
    }
    
    function fillName(){

        recruit = ["ELTON LIEW JUN HAO", "LEONARDO GRAVAMEN TSENG", "GOH JUN WEI", "ANG KHAO SHENG", "MUHAMMAD DANIAL KHAN BIN NORHISSAM", "WONG JUN WEN"];

        document.getElementById("name").classList.remove("mui--is-empty", "mui--is-untouched", "mui--is-pristine");
        document.getElementById("name").classList.add("mui--is-touched", "mui--is-dirty", "mui--is-not-empty");

        digits = formInput.elements.namedItem("fourDigits").value;
        for (i=1101;i<1114;i++){
            if (digits == i) {
                lookup = i - 1102;

                console.log("Success: " + recruit[lookup]);
                document.getElementById("name").value = recruit[lookup];

            }
        }
    }

    function copyToClipboard(){
          /* Get the text field */
        var copyText = document.getElementById("outputTextArea");

        /* Select the text field */
        copyText.select(); 
        copyText.setSelectionRange(0, 99999); /*For mobile devices*/

        /* Copy the text inside the text field */
        document.execCommand("copy");
    }

    // 2304 REC TRISTAN TOK YANG JUN has finished reporting sick at RHMC for open wound and received 5 days EX RMJ (040420-080420).


</script>


<!-- AUTOCOMPLETE SCRIPT -->
<script>

var statusList = ["LD", "RIB", "EX. RMJ", "EX. HEAVY LOADS", "EX. UPPER LIMBS", "UFD"];

$(document).on("focus", ".autoc", function() {
  if (!$(this).is(".aced"))
    $(this).addClass("aced").autocomplete({
      source: statusList
    });
})


// STOP AUTO ZOOM

myElement.addEventListener("click", event => {});
document.addEventListener("touchstart", event => {
    if(event.touches.length > 1) {
        alert
        event.preventDefault();
        event.stopPropagation(); // maybe useless
    }
}, {passive: false});

/*
document.addEventListener('touchmove',
        function(e) {
            e.preventDefault();
        }, {passive:false});
*/
</script>

<style>
    .ui-helper-hidden-accessible { display:none; }

    /*** iPhone and iOS Form Input Zoom Fixes ***/
    /* Fix Input Zoom on devices older than iPhone 5: */
    @media (hover:none) {
    /* start mobile styles */
    select, textarea, input[type=”text”], input[type=”password”],
    input[type=”datetime”], input[type=”datetime-local”],
    input[type=”date”], input[type=”month”], input[type=”time”],
    input[type=”week”], input[type=”number”], input[type=”email”],
    input[type=”url”]{ font-size: 16px !important; }
    /* end mobile styles */
    }
</style>

</html>